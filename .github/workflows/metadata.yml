name: Metadata Workflow

on:
  push:
    branches:
      - main

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 pyyaml google-api-python-client

    - name: Run scrape script
      run: |
        echo "Running metadata.py"
        python metadata.py > output.txt 2>&1

        # Print the contents of output.txt for debugging
        echo "Script Output:"
        cat output.txt

        # Print metadata dump for debugging
        echo "Metadata Dump:"
        cat meta_dump.txt

      continue-on-error: true

    - name: Check Git Status
      run: git status

    - name: Print XML Contents
      run: cat combined_epg.xml

    - name: Remove untracked files
      run: git clean -fdX

    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add combined_epg.xml
        git commit -m "Update combined epg.xml"
        git push
